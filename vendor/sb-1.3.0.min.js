Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),d=this,c=function(){},e=function(){return d.apply(this instanceof c?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;e.prototype=new c;return e});
var Spacebrew=Spacebrew||{},WebSocket=WebSocket||{},window=window||void 0,module=module||void 0;window&&!window.getQueryString&&(window.getQueryString=function(a){if(window.location)return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href),null==a?"":a[1]});!window&&module&&(WebSocket=require("ws"),module.exports={Spacebrew:Spacebrew});
Spacebrew.Client=function(a,b,d,c){c=c||{};void 0!=a&&"[object String]"!==toString.call(a)&&(c.port=a.port||void 0,c.debug=a.debug||!1,c.reconnect=a.reconnect||!1,d=a.description||void 0,b=a.name||void 0,a=a.server||void 0);this.debug="true"===window.getQueryString("debug")?!0:c.debug||!1;this.reconnect=c.reconnect||!0;this.reconnect_timer=void 0;this.send_interval=16;this.send_blocked=!1;this.msg={};this._name=b||"javascript client #";window&&(this._name=""!==window.getQueryString("name")?unescape(window.getQueryString("name")):
this._name);this._description=d||"spacebrew javascript client";window&&(this._description=""!==window.getQueryString("description")?unescape(window.getQueryString("description")):this._description);this.server=a||"sandbox.spacebrew.cc";window&&(this.server=""!==window.getQueryString("server")?unescape(window.getQueryString("server")):this.server);this.port=c.port||9E3;window&&(port=window.getQueryString("port"),""!==port&&!isNaN(port)&&(this.port=port));this.socket=null;this.client_config={name:this._name,
description:this._description,publish:{messages:[]},subscribe:{messages:[]},options:{}};this.admin={};this._isConnected=!1};Spacebrew.Client.prototype.connect=function(){try{this.socket=new WebSocket("ws://"+this.server+":"+this.port),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this._onMessage.bind(this),this.socket.onclose=this._onClose.bind(this)}catch(a){this._isConnected=!1,console.log("[connect:Spacebrew] connection attempt failed")}};
Spacebrew.Client.prototype.close=function(){try{this._isConnected&&(this.socket.close(),this._isConnected=!1,console.log("[close:Spacebrew] closing websocket connection"))}catch(a){this._isConnected=!1}};Spacebrew.Client.prototype.onOpen=function(){};Spacebrew.Client.prototype.onClose=function(){};Spacebrew.Client.prototype.onRangeMessage=function(){};Spacebrew.Client.prototype.onBooleanMessage=function(){};Spacebrew.Client.prototype.onStringMessage=function(){};
Spacebrew.Client.prototype.onCustomMessage=function(){};Spacebrew.Client.prototype.addPublish=function(a,b,d){this.client_config.publish.messages.push({name:a,type:b,"default":d});this.updatePubSub()};Spacebrew.Client.prototype.addSubscribe=function(a,b){this.client_config.subscribe.messages.push({name:a,type:b});this.updatePubSub()};Spacebrew.Client.prototype.updatePubSub=function(){this._isConnected&&this.socket.send(JSON.stringify({config:this.client_config}))};
Spacebrew.Client.prototype.send=function(a,b,d){var c=this;this.msg={message:{clientName:this._name,name:a,type:b,value:d}};this.send_blocked||(this.socket.send(JSON.stringify(this.msg)),this.send_blocked=!0,this.msg=void 0,setTimeout(function(){c.send_blocked=!1;void 0!=c.msg&&c.send(c.msg.message.name,c.msg.message.type,c.msg.message.value)},c.send_interval))};
Spacebrew.Client.prototype._onOpen=function(){console.log("[_onOpen:Spacebrew] Spacebrew connection opened, client name is: "+this._name);this._isConnected=!0;this.admin.active&&this.connectAdmin();this.reconnect_timer&&(console.log("[_onOpen:Spacebrew] tearing down reconnect timer"),this.reconnect_timer=clearInterval(this.reconnect_timer),this.reconnect_timer=void 0);this.updatePubSub();this.onOpen()};
Spacebrew.Client.prototype._onMessage=function(a){var b=JSON.parse(a.data),d;if(b.message){if(!b.message.clientName)switch(a=b.message.name,d=b.message.type,b=b.message.value,d){case "boolean":this.onBooleanMessage(a,"true"==b);break;case "string":this.onStringMessage(a,b);break;case "range":this.onRangeMessage(a,Number(b));break;default:this.onCustomMessage(a,b,d)}}else this.admin.active&&this._handleAdminMessages(b)};
Spacebrew.Client.prototype._onClose=function(){var a=this;console.log("[_onClose:Spacebrew] Spacebrew connection closed");this._isConnected=!1;this.admin.active&&(this.admin.remoteAddress=void 0);this.reconnect&&!this.reconnect_timer&&(console.log("[_onClose:Spacebrew] setting up reconnect timer"),this.reconnect_timer=setInterval(function(){!1!=a.isConnected&&(a.connect(),console.log("[reconnect:Spacebrew] attempting to reconnect to spacebrew"))},5E3));this.onClose()};
Spacebrew.Client.prototype.name=function(a){if(a){if(this._isConnected)return!1;this._name=a;window&&(this._name=""!==window.getQueryString("name")?unescape(window.getQueryString("name")):this._name);this.client_config.name=this._name}return this._name};
Spacebrew.Client.prototype.description=function(a){if(a){if(this._isConnected)return!1;this._description=a||"spacebrew javascript client";window&&(this._description=""!==window.getQueryString("description")?unescape(window.getQueryString("description")):this._description);this.client_config.description=this._description}return this._description};Spacebrew.Client.prototype.isConnected=function(){return this._isConnected};
Spacebrew.Client.prototype.extend=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};